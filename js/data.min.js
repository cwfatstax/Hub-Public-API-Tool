var dataController=function(){var n,t,e,o,a,i,s,c,r,l;t=[{id:"520471",permissions:3},{id:"550371",permissions:1},{id:"520674",permissions:1},{id:"550375",permissions:1},{id:"559716",permissions:3}],e=!1,a={},r={tab:"/v1/tab",channel:"/v1.1/channel",story:"/v1.1/story/add"},getURLs={tab:"/v1/tab/all?search=",channel:"/v1/channel/all?search=",story:"/v1.1/story/all?channel_id=",users:"/v1.1/admin/user/all"},putURLs={channel:"/v1/tabs/",story:"/v1.1/story/edit/"},deleteURLs={tab:"/v1/tab/",channel:"/v1/channel/",story:"/v1/story/archive/"},l=[];var u=function(t){n=t,sessionStorage.setItem("accessToken",t)},p=function(n){$.ajax({url:"https://pubapi.bigtincan.com/services/oauth2/token?",crossDomain:!0,method:"POST",dataType:"json",data:n,success:function(n){void 0!==n.access_token&&void 0!==n.refresh_token&&(console.log("Client authorization successful!"),u(n.access_token))},error:function(n){console.log(n.status+": "+n.statusText+" | "+n.responseText)}})},d=function(t){$.ajax({url:`https://pubapi.bigtincan.com${getURLs.users}`,crossDomain:!0,method:"GET",dataType:"json",contentType:"application/json",headers:{Accept:"application/json",Authorization:"Bearer "+n,"Content-Type":"application/json"},success:function(n,e){console.log("Active Tenant: "+n.data[0].company_name),t(n.data[0].company_name)},error:function(n,e,o){console.log(e),console.log("unable to get tenant name"),t(null)}})},h=function(n,t){o[n]["Property 5 Name"]="Files",o[n]["Property 5 Value"]=`https://app.bigtincan.com/story/${t}`},f=function(n,t){l.push({type:n,id:t})},g=function(t,e){let o=a[t.tab].channels[t.channel].stories[t.story].id,i={channels:[{id:a[t.tab].channels[t.channel].id}],append_files:[{filename:t.file,description:t.fileDescription}]};console.log("updateStory() with:"),console.log(o),console.log(i),$.ajax({url:`https://pubapi.bigtincan.com${putURLs.story}${o}`,crossDomain:!0,method:"PUT",dataType:"json",contentType:"application/json",data:JSON.stringify(i),headers:{Accept:"application/json",Authorization:"Bearer "+n,"Content-Type":"application/json",rhr:"1"},success:function(n,o){f("story",n.data.revision_id),h(t.rowNum,n.data.perm_id),a[t.tab].channels[t.channel].stories[t.story].id=n.data.revision_id,a[t.tab].channels[t.channel].stories[t.story].permID=n.data.perm_id,console.log("file added to existing story"),e()},error:function(n,t,e){console.log(t)}})},m=function(e,o){let i=a[e.tab].id,s=a[e.tab].channels[e.channel].id,c=t;console.log("addExistingChannel() with:"),console.log(s),console.log(c),$.ajax({url:`https://pubapi.bigtincan.com${putURLs.channel}${i}/channels/${s}/groups`,crossDomain:!0,method:"PUT",dataType:"json",contentType:"application/json",data:JSON.stringify(c),headers:{Accept:"application/json",Authorization:"Bearer "+n,"Content-Type":"application/json"},success:function(n,t){console.log("existing channel added to tab"),o()},error:function(n,t,e){console.log(t)}})},y=function(t,e,o){$.ajax({url:`https://pubapi.bigtincan.com${getURLs[t]}&page=${e}&limit=100`,crossDomain:!0,method:"GET",dataType:"json",contentType:"application/json",headers:{Accept:"application/json",Authorization:"Bearer "+n,"Content-Type":"application/json"},success:function(n,a){n.data.forEach(n=>{f(t,n.id),console.log(t+" "+n.id+" stored for deletion")}),n.page_total>e?y(t,e+1,o):"channel"==t?y("tab",1,o):o()},error:function(n,e,o){console.log(e),console.log("storeExistingEntities FAILED "+t)}})},b=function(){var n=Papa.unparse(o),t=new Blob([n],{type:"text/csv;charset=utf-8;"}),e=null;e=navigator.msSaveBlob?navigator.msSaveBlob(t,"output-with-properties.csv"):window.URL.createObjectURL(t);var a=document.createElement("a");a.href=e,a.setAttribute("download","output-with-properties.csv"),a.click()};return{storeAccessToken:function(n){u(n)},getAccessToken:function(){return n},authClientCredentials:function(n){p(n)},getTenantName:function(n){d(n)},storeInputData:function(n){o=n},getInputData:function(){return o},addStoryToInputData:function(n,t){h(n,t)},storeTenantStructure:function(n){a=n},getTenantStructure:function(){return a},getTabData:function(n){return i={name:`${n}`},i},getChannelData:function(n,e){return s={name:n,tab_id:e,is_hidden:!1,groups:t},s},getStoryData:function(n,t,o,a){return c={title:n,channels:[{id:t}],quickfile:e},""!=o&&(c.new_files=[{filename:o,description:a}]),c},updateStory:function(n,t){g(n,t)},addExistingChannel:function(n,t){m(n,t)},getAddURL:function(n){return r[n]},getGetURL:function(n){return getURLs[n]},getDeleteURL:function(n){return deleteURLs[n]},checkEntity:function(n,t,e){return checkEntity(n,t,e)},storeEntityCreated:function(n,t){f(n,t)},getEntitiesCreated:function(){return l},storeExistingEntities:function(n,t,e){y(n,t,e)},clearEntitiesCreated:function(){l=[]},downloadModuleLinkCSV:function(){b()}}}();